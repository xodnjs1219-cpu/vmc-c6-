# 예시: Userflow

## 1. 역할 선택 & 온보딩

**입력**

- 이메일/비밀번호
- 역할 선택 (Learner / Instructor)
- 공통 프로필 최소 입력: 이름, 휴대폰번호, 약관동의

**처리**

- Auth 계정 생성 (Supabase)
- 역할 저장 (`role=learner | instructor`)
- 프로필 레코드 생성
- 약관 이력 저장
- 기본 권한 토큰 발급

**출력**

- Learner → 코스 카탈로그 첫 진입
- Instructor → 대시보드 첫 진입

---

## 2. 코스 탐색 & 수강신청/취소 (Learner)

**입력**

- 검색어, 필터(카테고리, 난이도), 정렬(최신순/인기순)
- 코스 상세 진입
- “수강신청” / “수강취소” 버튼 클릭

**처리 (정책)**

- 코스 상태 `published`만 신청 가능
- 중복 신청 불가
- `enrollments` 테이블에 기록 생성
- 수강신청 시, 해당 `courses` 레코드의 `enrollments_count`를 1 증가시킨다.
- 수강취소 시 대시보드/내 코스에서 제거, 성적 집계 제외
- 수강취소 시, 해당 `courses` 레코드의 `enrollments_count`를 1 감소시킨다.

**출력**

- 신청/취소 성공/실패 피드백
- Learner 대시보드 반영

---

## 3. Learner 대시보드

**입력**

- 대시보드 접근

**처리 (정책)**

- 내 코스 목록 표시
- 진행률 계산(완료 과제 수/전체 과제 수)
- 마감 임박 과제 표시
- 최근 피드백 요약 표시

**출력**

- 내 코스, 진행률, 마감 임박 과제, 최근 피드백

---

## 4. 과제 상세 열람 (Learner)

**입력**

- 내 코스 → Assignment 목록 → Assignment 상세 클릭

**처리 (정책)**

- Assignment 상태 `published`만 열람 가능
- `closed` 상태면 제출 버튼 비활성화
- 본인 코스 등록 여부 검증

**출력**

- 과제 설명, 마감일, 점수 비중, 정책(지각 허용 여부/재제출 허용 여부)
- 제출 UI(text+link 입력란)

---

## 5. 과제 제출/재제출 (Learner)

**입력**

- Text 필드(필수), Link 필드(선택, URL 형식) **(파일 업로드는 현재 미지원)**
- 제출 버튼 클릭

**처리 (정책)**

- 마감일 전: 정상 제출 (`status=submitted`)
- 마감일 후:

  - `지각 허용 = true` → `status=submitted`, `late=true`
  - `지각 허용 = false` → 제출 차단

- 재제출 허용 여부 검증
- 텍스트/링크 유효성 검사
- `status`가 `resubmission_required`인 과제를 재제출할 때도, `assignments`의 `due_date`를 기준으로 `late` 여부를 판단하여 기록한다.

**출력**

- 제출 성공/실패 메시지
- Learner 화면에서 상태 업데이트

---

## 6. 성적 & 피드백 열람 (Learner)

**입력**

- 성적 페이지 접근

**처리 (정책)**

- 본인 제출물만 조회 가능
- 과제별 점수, 지각 여부, 재제출 여부, 피드백 표시
- 코스별 총점 계산(과제 점수 × 비중)

**출력**

- 과제별 점수/상태
- 코스 총점 요약

---

## 7. Instructor 대시보드

**입력**

- 대시보드 접근

**처리 (정책)**

- 내 코스 목록 표시(draft/published/archived)
- 채점 대기 수 표시
- 최근 제출물 표시

**출력**

- 내 코스, 채점 대기, 최근 제출물

---

## 8. 코스 관리 (Instructor)

**입력**

- 코스 생성/수정 (제목, 소개, 카테고리, 난이도, 커리큘럼)
- 상태 전환(draft/published/archived)

**처리 (정책)**

- 소유자만 접근 가능
- `draft → published` 전환 시 공개
- `published → archived` 전환 시 신규 수강을 차단하며, 해당 코스에 속한 모든 `published` 상태의 과제는 자동으로 `closed` 상태로 변경된다.

**출력**

- 생성/수정/상태 전환 결과 반영

---

## 9. 과제 관리 (Instructor)

**입력**

- 과제 생성/수정 (제목, 설명, 마감일, 점수 비중, 지각/재제출 정책)
- 상태 전환(draft/published/closed)

**처리 (정책)**

- 소유 코스만 접근 가능
- 게시 시 학습자 노출
- 마감일 이후 자동 `closed`
- 제출물 테이블: 필터(미채점/지각/재제출요청)

**출력**

- Assignment 목록 갱신
- Learner 화면 반영

---

## 10. 제출물 채점 & 피드백 (Instructor)

**입력**

- 제출물 선택
- 점수(0~100), 피드백 작성
- “재제출 요청” 버튼 선택 가능

**처리 (정책)**

- 점수 범위 제한
- 피드백 필수
- 점수 입력 → `graded`
- 재제출 요청 → `resubmission_required`

**출력**

- Learner에게 피드백 표시
- Learner 대시보드 과제 상태 반영

---

## 11. Assignment 게시/마감 (Instructor)

**입력**

- 과제 게시/마감

**처리 (정책)**

- `draft → published` 전환 시 학습자 노출
- 마감일 이후 자동 `closed`
- 수동 마감 가능
- 마감 후 제출 불가, 채점만 가능

**출력**

- Assignment 상태 갱신
- Learner 화면 반영

---

## 12. 운영 (Operator)

**입력**

- 신고 접수(코스/과제/제출물/사용자, 사유, 내용)
- 메타데이터 관리(카테고리, 난이도)

**처리 (정책)**

- 운영자 권한 가드
- 신고 처리 상태: received → investigating → resolved
- 액션: 경고, 제출물 무효화, 계정 제한
- 메타데이터 CRUD (사용 중 값은 비활성화 처리 권장)

**출력**

- 처리 결과 알림
- 메타데이터 갱신
